**Общая Идея Системы:**

Система предназначена для сбора данных о различных аспектах жизни граждан (финансовых, социальных, поведенческих и т.д.), обработки этих данных с использованием набора правил для вычисления "социального рейтинга" и хранения как детальной информации, так и агрегированных аналитических данных. Система использует микросервисную архитектуру с разделением ответственности между различными типами баз данных, каждая из которых выбрана за свои сильные стороны, и потоковой платформой для обработки данных в реальном времени.

**Поток Данных и Компоненты:**

1.  **Источники Данных (Подразумеваются):** Различные системы генерируют события, связанные с гражданами (например, финансовые транзакции, участие в общественных мероприятиях, правонарушения, онлайн-активность).
2.  **Redpanda (Платформа Потоковой Передачи):**
    *   **Назначение:** Служит центральной, высокопроизводительной и Kafka-совместимой шиной данных. Все события от источников публикуются в топики Redpanda. Это обеспечивает буферизацию, отказоустойчивость и возможность потребления данных несколькими системами.
3.  **Flink (Потоковый Обработчик):**
    *   **Назначение:** Ядро обработки данных в реальном времени. Flink:
        *   Читает потоки событий из топиков Redpanda.
        *   Загружает актуальные правила скоринга и конфигурации из **MongoDB**.
        *   Применяет эти правила к событиям, вычисляя влияние на рейтинг.
        *   Записывает результаты обработки и обновленные данные в соответствующие базы данных.
        *   Может генерировать агрегаты или новые события (оповещения) обратно в Redpanda или напрямую в аналитические хранилища.
4.  **Базы Данных (Разделение Ответственности):**

    *   **MongoDB (`mongodb.txt`):**
        *   **Назначение:** Хранение гибких, документо-ориентированных данных.
        *   **Данные:**
            *   **Профили граждан (`citizens`):** Основная информация, контактные данные, демография, флаги (госслужащий, нарушения). Хорошо подходит для данных с переменной структурой.
            *   **Правила скоринга (`scoring_rules`):** Детальное описание правил (условия, баллы, множители, эффекты на связанных лиц). Гибкость MongoDB удобна для сложных структур правил.
            *   **Конфигурации правил (`rule_configurations`):** Наборы правил, пороговые значения для уровней рейтинга, правила "затухания" баллов.
            *   **Снэпшот рейтинга (`citizens.scoreSnapshot`):** Хранит *текущее* значение рейтинга и уровень гражданина на момент последнего расчета Flink.

    *   **Dgraph (`dgraph.txt`):**
        *   **Назначение:** Хранение и обработка графовых данных, моделирование сложных связей.
        *   **Данные:**
            *   **Сущности `Citizen`:** Представление граждан как узлов графа.
            *   **Связи (`family`, `colleagues`, `friends`):** Явное моделирование социальных связей между гражданами.
            *   **История рейтинга (`scoreHistory: [ScoreChange]`):** Хранение *полной детальной истории* изменений рейтинга как списка, привязанного непосредственно к узлу гражданина. Идеально для запросов "покажи всю историю для этого человека".
            *   **Геолокация (`location`):** Связь гражданина с географическими данными.

    *   **InfluxDB (`influxdb.txt`):**
        *   **Назначение:** Хранение и анализ данных временных рядов (time-series data). Оптимизирована для быстрой записи и чтения данных с временными метками.
        *   **Данные:**
            *   **События (`events`):** Поток всех входящих событий с временными метками, тегами для фильтрации (гражданин, тип, регион) и полями значений (влияние на рейтинг).
            *   **История рейтинга (`score_history`):** Дублирует данные из Dgraph, но в формате временного ряда. Удобно для анализа трендов изменения рейтинга *во времени* по всем или группам граждан.
            *   **Метрики и Агрегаты (`region_score_aggregates`, `citizen_activity_metrics`, `social_graph_metrics`):** Результаты периодических расчетов (средние значения, тренды активности, простые метрики графа), хранящиеся как временные ряды.

    *   **ClickHouse (`clickhouse.sql`):**
        *   **Назначение:** Быстрая обработка аналитических запросов (OLAP) на больших объемах данных. Хранение агрегированных данных и архивов.
        *   **Данные:**
            *   **Агрегаты (`events_aggregate`, `credit_score_aggregate`, `social_graph_aggregate`, `score_velocity_metrics`):** Предрасчитанные Flink'ом или самой ClickHouse данные, сгруппированные по различным измерениям (дата, регион, тип события, возрастная группа и т.д.) для быстрой аналитики и построения отчетов.
            *   **Архив событий (`events_archive`):** Долговременное хранилище прошедших событий (возможно, с TTL) для ретроспективного анализа.
